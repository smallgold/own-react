<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>own react</title>
</head>

<body>
  <p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªrenderå‡½æ•°ï¼Œå…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªå…ƒç´ {element}åŠå…¶å­å…ƒç´ {children}å‘ˆç°ç»™-DOMã€ŒparentDom.appendChild(dom);ã€ã€‚</p>
  <p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çš„æ˜¯createElementçš„ç®€å•æ–¹æ³•ã€‚</p>
  <p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­åšåˆ°è¿™ä¸€ç‚¹ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†è®©JSXä¸Didactä¸€èµ·å·¥ä½œã€‚</p>
  <div id="root"></div>
  <script>
    const Didact = importFromBelow();
    const stories = [
      { name: "Didact introduction", url: "https://github.com/chinanf-boy/didact-explain" },
      { name: "Rendering DOM elements ", url: "https://github.com/chinanf-boy/didact-explain" },
      { name: "Element creation and JSX", url: "https://github.com/chinanf-boy/didact-explain" },
      { name: "Instances and reconciliation", url: "https://github.com/chinanf-boy/didact-explain" },
      { name: "Components and state", url: "https://github.com/chinanf-boy/didact-explain" }
    ];

    const appElement = {
      type: "div",
      props: {
        children: [
          {
            type: "ul",
            props: {
              children: stories.map(storyElement)
            }
          }
        ]
      }
    };

    function storyElement({ name, url }) {
      const likes = Math.ceil(Math.random() * 100);
      const buttonElement = {
        type: "button",
        props: {
          children: [
            { type: "TEXT ELEMENT", props: { nodeValue: likes } },
            { type: "TEXT ELEMENT", props: { nodeValue: "â¤ï¸" } }
          ]
        }
      };
      const linkElement = {
        type: "a",
        props: {
          href: url,
          children: [{ type: "TEXT ELEMENT", props: { nodeValue: name } }]
        }
      };

      return {
        type: "li",
        props: {
          children: [buttonElement, linkElement]
        }
      };
    }

    Didact.render(appElement, document.getElementById("root"));

    /** â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ ğŸŒ¼DidactğŸŒ¼ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ **/

    function importFromBelow() {
      function render(element, parentDom) {
        const { type, props } = element; // è·å–ç±»å‹ å’Œ å±æ€§å¯¹è±¡
        const isTextElement = type === "TEXT ELEMENT"; // æ–‡æœ¬ç±»å‹åˆ¤å®š
        const dom = isTextElement
          ? document.createTextNode("") // åˆ›å»º-ç±»å‹-æ–‡æœ¬
          : document.createElement(type); // åˆ›å»º-ç±»å‹-å…ƒç´ 

        const isListener = name => name.startsWith("on"); // åˆ¤æ–­å¼€å¤´æ˜¯å¦ä¸ºon; äº‹ä»¶ç›‘å¬å™¨;
        Object.keys(props).filter(isListener).forEach(name => {
          const eventType = name.toLocaleLowerCase().substring(2); // å–ä¸¤ä½å
          // ç›‘å¬æ¯ä¸€ä¸ªå¼€å¤´ä¸º on çš„å‡½æ•°å±æ€§ å¹¶æ¿€æ´» props[name] å‡½æ•°
          dom.addEventListener(eventType, props[name])
        })
        // åˆ¤æ–­ props çš„å€¼ä¸ä¸ºç›‘å¬äº‹ä»¶å’Œå­å…ƒç´ ;
        const isAttribute = name => !isListener(name) && name != "children";
        // è¿‡æ»¤å‡ºæ¥çš„å±æ€§èµ‹å€¼äº dom
        Object.keys(props).filter(isAttribute).forEach(name => {
          dom[name] = props[name];
        });

        const childElements = props.children || []; // è·å–-å­å…ƒç´ 
        childElements.forEach(childElement => { render(childElement, dom); }) // é€’å½’å­å…ƒç´  å°†å­å…ƒç´ åŠ å…¥å½“å‰å…ƒç´ ä¸­;
        parentDom.appendChild(dom) // å°†å½“å‰å…ƒç´ é›†åˆåŠ å…¥çˆ¶çº§å…ƒç´ ;
      }

      return {
        render
      };
    }
  </script>
</body>

</html>