<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>own react</title>
</head>

<body>
  <p>ä¸Šæ¬¡æˆ‘ä»¬ä»‹ç»äº†Didact Elementsï¼Œå®ƒæ˜¯ä¸€ç§æè¿°æˆ‘ä»¬æƒ³è¦å‘ˆç°ç»™-DOM-çš„éå¸¸è¯¦ç»†çš„æ–¹å¼{æ•°æ®ç»“æ„}ã€‚</p>
  <p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨JSXæ¥ç®€åŒ–å…ƒç´ çš„åˆ›å»ºã€‚</p>
  <p>JSXæä¾›äº†ä¸€äº›è¯­æ³•ç³–æ¥åˆ›å»ºå…ƒç´ ã€‚ä»¥ä¾¿ä»£æ›¿ï¼š</p>
  <pre>
    const element = {
      type: "div",
      props: {
        id: "container",
        children: [
          { type: "input", props: { value: "foo", type: "text" } },
          {
            type: "a",
            props: {
            href: "/bar",
            children: [{ type: "TEXT ELEMENT", props: { nodeValue: "bar" } }]
            }
          },
          {
            type: "span",
            props: {
            onClick: e => alert("Hi"),
            children: [{ type: "TEXT ELEMENT", props: { nodeValue: "click me" } }]
            }
          }
        ]
      }
    };
  </pre>
  <p>æˆ‘ä»¬çš„ä»£ç å¯ä»¥æ˜¯</p>
  <pre>
    <span>const</span> <span>element</span> <span>=</span> (
      <span>&lt;</span>div id<span>=</span><span><span>"</span>container<span>"</span></span><span>&gt;</span>
        <span>&lt;</span>input value<span>=</span><span><span>"</span>foo<span>"</span></span> type<span>=</span><span><span>"</span>text<span>"</span></span> <span>/</span><span>&gt;</span>
        <span>&lt;</span>a href<span>=</span><span><span>"</span>/bar<span>"</span></span><span>&gt;</span>bar<span>&lt;</span><span>/</span>a<span>&gt;</span>
        <span>&lt;</span>span onClick<span>=</span>{<span>e</span> <span>=&gt;</span> <span>alert</span>(<span><span>"</span>Hi<span>"</span></span>)}<span>&gt;</span>click me<span>&lt;</span><span>/</span>span<span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
    );
  </pre>
  <p>å¦‚æœä½ å¯¹JSXä¸ç†Ÿæ‚‰ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“æœ€åä¸€ä¸ªç‰‡æ®µæ˜¯å¦æ˜¯æœ‰æ•ˆçš„javascriptï¼šå®ƒä¸æ˜¯ã€‚</p>
  <p>ä¸ºäº†ä½¿æµè§ˆå™¨çš„ç†è§£ï¼Œéœ€è¦çš„ä»£ç ç”±é¢„å¤„ç†è½¬åŒ–ä¸º-æœ‰æ•ˆçš„JSï¼Œåƒbabeläº†è§£æ›´å¤šå…³äºJSXé˜…è¯»è¿™ç¯‡æ–‡ç« ç”±è´¾æ£®Â·ç±³å‹’ã€‚</p>
  <p>ä¾‹å¦‚ï¼Œbabelä»ä¸Šé¢å°†JSXè½¬æ¢ä¸ºï¼š</p>
  <pre>
    const element = createElement(
      "div",
      { id: "container" },
      createElement("input", { value: "foo", type: "text" }),
      createElement(
        "a",
        { href: "/bar" },
        "bar"
      ),
      createElement(
        "span",
        { onClick: e => alert("Hi") },
        "click me"
      )
    );
  </pre>
  <p>æˆ‘ä»¬éœ€è¦æ·»åŠ åˆ°Didactä¸­æ¥æ”¯æŒJSXæ˜¯ä¸€ä¸ªcreateElementåŠŸèƒ½ï¼Œè¿™å°±æ˜¯å…¶ä½™éƒ¨åˆ†å·¥ä½œç”±-é¢„å¤„ç†å™¨-å®Œæˆçš„ã€‚</p>
  <p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯typeå…ƒç´ çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒç´ çš„å¯¹è±¡propsï¼Œä»¥åŠæ‰€æœ‰ä¸‹é¢çš„å‚æ•°childrenã€‚</p>
  <p>createElementéœ€è¦åˆ›å»ºä¸€ä¸ªpropså¯¹è±¡ï¼Œå°†å…¶åˆ†é…ç»™ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„æ‰€æœ‰å€¼ï¼Œå°†è¯¥childrenå±æ€§è®¾ç½®ä¸ºç¬¬äºŒä¸ªå‚æ•°åé¢çš„æ‰€æœ‰å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡{} - å¸¦æœ‰ {type, props }ã€‚æŠŠå®ƒæ”¾åˆ°ä»£ç ä¸­æ›´å®¹æ˜“ï¼š</p>
  <pre>
    function createElement(type, config, ...args) {
      const props = Object.assign({}, config);// åˆå¹¶
      const hasChildren = args.length > 0; // å­©å­ï¼Ÿ
      props.children = hasChildren ? [].concat(...args) : [];
      return { type, props }; // Didactå…ƒç´ çš„æ•°æ®ç»“æ„-ç±»å‹{type}ä¸å±æ€§{props}
    }
  </pre>
  <p>é™¤äº†ä¸€ä»¶äº‹æƒ…ä¹‹å¤–ï¼Œè¿™ä¸ªå‡½æ•°è¿è¡Œè‰¯å¥½ï¼šæ–‡æœ¬å…ƒç´ ã€‚</p>
  <p>æ–‡æœ¬-ä½œä¸ºå­—ç¬¦ä¸²-ä¼ é€’ç»™createElementå‡½æ•°ï¼ŒDidactéœ€è¦æ–‡æœ¬å…ƒç´ typeä»¥åŠpropså…¶ä½™å…ƒç´ ã€‚</p>
  <p>æ‰€ä»¥æˆ‘ä»¬å°†æ¯ä¸ªargè½¬æ¢ä¸ºä¸€ä¸ªæ–‡æœ¬å…ƒç´ -ä¸€ä¸ªè§„èŒƒçš„`Didactå…ƒç´ ï¼š</p>
  <pre>
    const TEXT_ELEMENT = "TEXT ELEMENT"; // ç±»å‹

    function createElement(type, config, ...args) {
      const props = Object.assign({}, config);
      const hasChildren = args.length > 0;
      const rawChildren = hasChildren ? [].concat(...args) : [];
      props.children = rawChildren
        .filter(c => c != null && c !== false)
        .map(c => c instanceof Object ? c : createTextElement(c));
        // è¿‡æ»¤-ç©º-å€¼, å‰©ä¸‹çš„-ä¸å±äº-Objectçš„å€¼ -> createTextElement -> å˜ä¸º ç±»å‹ä¸ºTEXT_ELEMENT- Didactå…ƒç´ 
      return { type, props };
    }
    
    function createTextElement(value) {
      // è§„èŒƒæ•°æ®
      return createElement(TEXT_ELEMENT, { nodeValue: value });
    }
  </pre>
  <p>æˆ‘è¿˜ç­›é€‰äº†è¦æ’é™¤çš„å­é¡¹åˆ—è¡¨nullï¼Œundefinedå¹¶æŒ‡å‡ºfalse.</p>
  <p>æˆ‘ä»¬ä¸ä¼šå‘ˆç°è¿™äº›å­é¡¹ï¼Œå› æ­¤ä¸éœ€è¦æ·»åŠ å®ƒä»¬props.childrenã€‚</p>
  <a href="https://codepen.io/pomber/pen/xdmoWE?editors=0010">codepen</a>
  <script>
    /** @jsx Didact.createElement */
    const Didact = importFromBelow();


    /** â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ ğŸŒ¼DidactğŸŒ¼ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ **/

    function importFromBelow() {
      const TEXT_ELEMENT = "TEXT ELEMENT";
      function render(element, parentDom) {
        const { type, props } = element;

        // Create DOM element
        const isTextElement = type === TEXT_ELEMENT;
        const dom = isTextElement
          ? document.createTextNode("")
          : document.createElement(type);

        // Add event listeners
        const isListener = name => name.startsWith("on");
        Object.keys(props).filter(isListener).forEach(name => {
          const eventType = name.toLowerCase().substring(2);
          dom.addEventListener(eventType, props[name]);
        });

        // Set properties
        const isAttribute = name => !isListener(name) && name != "children";
        Object.keys(props).filter(isAttribute).forEach(name => {
          dom[name] = props[name];
        });

        // Render children
        const childElements = props.children || [];
        childElements.forEach(childElement => render(childElement, dom));

        // Append to parent
        parentDom.appendChild(dom);
      }

      function createElement(type, config, ...args) {
        const props = Object.assign({}, config);
        const hasChildren = args.length > 0;
        const rawChildren = hasChildren ? [].concat(...args) : [];
        props.children = rawChildren
          .filter(c => c != null && c !== false)
          .map(c => c instanceof Object ? c : createTextElement(c));
        return { type, props };
      }

      function createTextElement(value) {
        return createElement(TEXT_ELEMENT, { nodeValue: value });
      }

      return {
        render,
        createElement
      };
    }
  </script>
</body>

</html>